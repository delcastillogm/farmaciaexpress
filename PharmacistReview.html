<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Pedidos â€“ Farmacia Express</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Z5h6y0aVjFv9KkUOJd7g6mA1U4pV+U1k9+4eG9g8pU2b2pA+P4F5J1cF1sH6N1z0d" crossorigin="anonymous">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" integrity="sha384-wM7g7bFe1JQKX7uZb2W9Zg8mP4m9G7bF5J1cF1sH6N1z0dZ5h6y0aVjFv9KkUOJd" crossorigin="anonymous">
  <style>
    :root{
      --border:#e5e7eb;
      --muted:#6b7280;
      --card:#ffffff;
    }
    body{background:#f6f7fb !important;}
    .navbar{background:#ffffff!important; border-bottom:1px solid var(--border)!important;}
    .card{background:var(--card)!important; border:1px solid var(--border)!important; border-radius:16px!important;}
    .progress{background:#e9edf5!important;}
    .progress-bar{background:#0d6efd!important;}
    .badge-outline{background:#f8fafc!important; color:#111827!important; border:1px solid var(--border)!important;}
    .list-btn{background:#ffffff!important; border:1px solid var(--border)!important; color:#111827!important;}
    .list-btn:hover{background:#f8fafc!important;}
    .list-btn.active{background:#e7f0ff!important; border-color:#0d6efd!important;}
    .list-btn .price{color:var(--muted)!important;}
    .soft{background:#f8fafc!important; border:1px solid var(--border)!important;}
    .timeline-row{display:flex; gap:.75rem; margin-bottom:1rem;}
    .timeline-dot{width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff;}
    .sep{height:1px; background:var(--border)!important; margin:1rem 0;}
    .link-plain{text-decoration:none!important;}
    /* Mejoras de tabla para productos */
    .table > :not(caption) > * > * { background-color: var(--card) !important; }
  </style>
</head>
<body>
<!-- NAV -->
<nav class="navbar sticky-top">
  <div class="container">
    <a class="navbar-brand fw-semibold d-flex align-items-center gap-2 link-plain" href="home.html">
      <i class="bi bi-capsule text-primary"></i> <span>Farmacia Express</span>
    </a>
    <form class="d-none d-lg-flex ms-auto me-3" role="search" onsubmit="event.preventDefault()">
      <div class="input-group">
        <span class="input-group-text soft"><i class="bi bi-search text-muted"></i></span>
        <input class="form-control soft" placeholder="Buscar productosâ€¦" disabled>
      </div>
    </form>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-primary" href="soporte.html"><i class="bi bi-chat-dots me-1"></i> Soporte</a>
      <a class="btn btn-outline-secondary" href="#"><i class="bi bi-truck me-1"></i> Pedidos</a>
    </div>
  </div>
</nav>
<!-- BACK -->
<div class="container">
  <a href="home.html" class="btn btn-link text-decoration-none mt-3 mb-2">
    <i class="bi bi-arrow-left"></i> Volver
  </a>
</div>
<!-- MAIN -->
<main class="container pb-5">
  <div class="row g-4">
    <!-- LEFT: order list -->
    <div class="col-lg-4">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="fw-semibold mb-3">Mis Pedidos</h5>
          <div id="ordersList" class="d-grid gap-2"></div>
        </div>
      </div>
    </div>
    <!-- RIGHT: order detail -->
    <div class="col-lg-8">
      <div class="card h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">Pedido <span id="ordTitle">#â€”</span></h5>
            <span id="ordStatus" class="badge badge-outline">â€”</span>
          </div>
          <div class="progress mb-3" role="progressbar">
            <div id="ordProgress" class="progress-bar" style="width:0%"></div>
          </div>
          <div id="etaWrap" class="alert soft d-flex align-items-center mb-3">
            <i class="bi bi-clock-history me-2 text-primary"></i>
            <div>Entrega estimada: <strong id="ordEta">â€”</strong></div>
          </div>
          <div id="driverWrap" class="d-flex align-items-center gap-3 p-3 rounded soft mb-4 d-none">
            <div class="fs-2">ðŸ›µ</div>
            <div class="flex-grow-1">
              <div>Tu repartidor: <strong id="ordRider">â€”</strong></div>
              <div class="text-muted small" id="ordVehicle">â€”</div>
            </div>
            <a id="ordCall" class="btn btn-outline-primary" href="#"><i class="bi bi-telephone me-1"></i> Llamar</a>
          </div>
          <h6 class="fw-semibold">Historial del pedido</h6>
          <div id="ordTimeline" class="mt-3"></div>
          <div class="sep"></div>
          <h6 class="fw-semibold">Productos del pedido</h6>
          <div class="table-responsive">
            <table class="table align-middle mb-2">
              <tbody id="ordItems"></tbody>
              <tfoot>
              <tr>
                <td class="text-end fw-semibold" colspan="3">Total</td>
                <td class="fw-bold" id="ordTotal">S/0.00</td>
              </tr>
              </tfoot>
            </table>
          </div>
          <div class="text-muted small mt-2"><i class="bi bi-geo-alt me-1"></i><span id="ordAddress">â€”</span></div>
        </div>
      </div>
    </div>
  </div>
</main>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoN0z1HgR6AM4V6j5p6Wv5C6Yp1plf4b5QeXx8lL3Q9i9yi" crossorigin="anonymous"></script>
<script>
  /* ===== Mock data ===== */
  const statusConfig = {
    registered: { label:'Registrado',  icon:'bi-box',          color:'#3b82f6' },
    evaluated:  { label:'Evaluado',    icon:'bi-patch-check',  color:'#f59e0b' },
    prepared:   { label:'Preparado',   icon:'bi-box-seam',     color:'#facc15' },
    dispatched: { label:'En camino',   icon:'bi-truck',        color:'#8b5cf6' },
    delivered:  { label:'Entregado',   icon:'bi-check-circle', color:'#22c55e' },
  };
  let mockOrders = [
    {
      id:"1",
      number:"MD123456",
      status:"dispatched",
      estimatedDelivery:new Date(Date.now()+15*60*1000),
      deliveryAddress:"Calle Lima 123, Lima",
      total:23.43,
      items:[
        { name:"Ibuprofeno 400mg", quantity:1, price:3.45 },
        { name:"Vitamina C 1000mg", quantity:2, price:8.99 },
        { name:"Paracetamol 500mg", quantity:1, price:2.85 }
      ],
      statusHistory:[
        { id:"1", status:"registered", timestamp:new Date(Date.now()-45*60*1000), description:"Pedido registrado y confirmado" },
        { id:"2", status:"evaluated",  timestamp:new Date(Date.now()-35*60*1000), description:"Prescripciones verificadas y pedido aprobado" },
        { id:"3", status:"prepared",   timestamp:new Date(Date.now()-15*60*1000), description:"Productos preparados y empaquetados" },
        { id:"4", status:"dispatched", timestamp:new Date(Date.now()-5*60*1000),  description:"Pedido en camino con el repartidor" }
      ],
      driverInfo:{ name:"Carlos RodrÃ­guez", phone:"+51 966 123 456", vehicle:"Moto - ABC1234" }
    },
    {
      id:"2",
      number:"MD123455",
      status:"delivered",
      estimatedDelivery:new Date(Date.now()-2*60*60*1000),
      deliveryAddress:"Avenida de la Paz 45, Lima",
      total:15.99,
      items:[
        { name:"Frenadol Complex", quantity:1, price:6.75 },
        { name:"Crema Hidratante", quantity:1, price:12.99 }
      ],
      statusHistory:[
        { id:"1", status:"registered", timestamp:new Date(Date.now()-3*60*60*1000),  description:"Pedido registrado y confirmado" },
        { id:"2", status:"evaluated",  timestamp:new Date(Date.now()-2.5*60*60*1000),description:"Pedido verificado y aprobado" },
        { id:"3", status:"prepared",   timestamp:new Date(Date.now()-2.2*60*60*1000),description:"Productos preparados y empaquetados" },
        { id:"4", status:"dispatched", timestamp:new Date(Date.now()-2.1*60*60*1000),description:"Pedido en camino con el repartidor" },
        { id:"5", status:"delivered",  timestamp:new Date(Date.now()-2*60*60*1000),  description:"Pedido entregado exitosamente" }
      ]
    }
  ];
  let selectedOrder = mockOrders[0];
  /* ===== Helpers ===== */
  const el = sel => document.querySelector(sel);
  function getStatusProgress(s){ const order=["registered","evaluated","prepared","dispatched","delivered"]; return ((order.indexOf(s)+1)/order.length)*100; }
  function timeAgo(date){
    const diff = Math.floor((Date.now()-date.getTime())/60000);
    if(diff<60) return `Hace ${diff} minutos`;
    const h=Math.floor(diff/60); if(diff<1440) return `Hace ${h} hora${h>1?'s':''}`;
    const d=Math.floor(diff/1440); return `Hace ${d} dÃ­a${d>1?'s':''}`;
  }
  function fmtEta(date){
    const hh=String(date.getHours()).padStart(2,'0');
    const mm=String(date.getMinutes()).padStart(2,'0');
    const ampm=date.getHours()>=12?'p. m.':'a. m.';
    const mins=Math.max(1,Math.round((date.getTime()-Date.now())/60000));
    return `${hh}:${mm} ${ampm} (${mins} min)`;
  }
  const fmt = (n)=>'S/'+n.toFixed(2);
  /* ===== Render list + detail ===== */
  function renderOrdersList(){
    const wrap = el('#ordersList'); wrap.innerHTML='';
    mockOrders.forEach(o=>{
      const btn=document.createElement('button');
      btn.className='btn list-btn d-flex justify-content-between align-items-center';
      if(selectedOrder.id===o.id) btn.classList.add('active');
      btn.innerHTML = `
      <span class="small">#${o.number}</span>
      <span class="d-flex align-items-center gap-2">
        <span class="badge ${o.status==='delivered'?'text-bg-success':'text-bg-secondary'}">${statusConfig[o.status].label}</span>
        <span class="price">${fmt(o.total)}</span>
      </span>`;
      btn.onclick=()=>{selectedOrder=o; renderOrderDetail(); renderOrdersList();};
      wrap.appendChild(btn);
    });
  }
  function renderOrderDetail(){
    const o=selectedOrder;
    el('#ordTitle').textContent = '#'+o.number;
    const st = el('#ordStatus');
    st.textContent = statusConfig[o.status].label;
    st.className = 'badge '+(o.status==='delivered'?'text-bg-success':'badge-outline');
    el('#ordProgress').style.width = getStatusProgress(o.status)+'%';
    const etaWrap = el('#etaWrap');
    etaWrap.classList.toggle('d-none', o.status==='delivered');
    if(o.status!=='delivered'){
      el('#ordEta').textContent = fmtEta(o.estimatedDelivery);
    }
    const driverWrap = el('#driverWrap');
    const showDriver = o.status==='dispatched' && o.driverInfo;
    driverWrap.classList.toggle('d-none', !showDriver);
    if(showDriver){
      el('#ordRider').textContent   = o.driverInfo.name;
      el('#ordVehicle').textContent = o.driverInfo.vehicle;
      el('#ordCall').href           = `tel:${o.driverInfo.phone.replace(/\s+/g,'')}`;
    }
    // timeline
    const tl = el('#ordTimeline'); tl.innerHTML='';
    o.statusHistory.forEach((s,i)=>{
      const last = i===o.statusHistory.length-1;
      const row=document.createElement('div');
      row.className='timeline-row';
      row.innerHTML = `
      <div class="d-flex flex-column align-items-center">
        <div class="timeline-dot" style="background:${statusConfig[s.status].color}">
          <i class="bi ${statusConfig[s.status].icon}"></i>
        </div>
        ${!last?'<div style="width:2px;height:24px;background: var(--border); margin-top:8px"></div>':''}
      </div>
      <div class="flex-grow-1">
        <div class="d-flex justify-content-between">
          <div class="fw-semibold small">${statusConfig[s.status].label}</div>
          <div class="text-muted small">${timeAgo(s.timestamp)}</div>
        </div>
        <div class="text-muted small">${s.description}</div>
      </div>`;
      tl.appendChild(row);
    });
    // items
    const tb = el('#ordItems'); tb.innerHTML='';
    let total=0;
    o.items.forEach(it=>{
      total += it.price*it.quantity;
      const tr=document.createElement('tr');
      tr.innerHTML = `<td>${it.quantity}Ã—</td><td>${it.name}</td><td></td><td class="text-end">${fmt(it.price*it.quantity)}</td>`;
      tb.appendChild(tr);
    });
    el('#ordTotal').textContent = fmt(total);
    el('#ordAddress').textContent = o.deliveryAddress;
  }
  /* init */
  renderOrdersList();
  renderOrderDetail();
</script>
</body>
</html>
